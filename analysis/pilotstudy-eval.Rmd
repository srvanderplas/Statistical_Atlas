---
title: "Framed!"
author: Heike Hofmann, Susan Vander Plas
ratio: 16x10
output:
  rmdshower::shower_presentation:
    self_contained: false
    katex: true
    theme: ribbon
---

```{r data, echo=FALSE, eval=FALSE, message = FALSE, warning=FALSE}
library(tidyverse)

responses <- read.csv("../analysis/Frame Study - Pics_February 3, 2018_13.57 2.csv")
responses <- responses[-(1:2),]
responses <- responses %>% rename(
  Age=Q56, 
  Gender = Q520,
  Education=Q524
  )

percentages <- responses %>% select(IPAddress, ResponseId,  grep("Q...$", names(responses), value=TRUE), grep("Q..$", names(responses), value=TRUE)) %>% gather(question, howmuch, matches("Q..."), matches("Q.."))
percentages$howmuch <- as.numeric(percentages$howmuch)

pl <- read.csv("/Users/heike/papers/2018-Atlas-study/data/PlotLabels-Pilot.csv")
percentages <- percentages %>% left_join(pl %>% select(Question, perc, Type, Frame, isFrame), by=c("question"="Question"))

# introduce relative and absolute error
percentages <- percentages %>% mutate(
  rel.error = (howmuch-perc)/perc,
  diff.error = howmuch-perc
)
# percentages <- percentages %>% filter(howmuch < 75) %>% na.omit() %>% mutate(
#   rel.error = (howmuch-perc)/perc,
#   diff.error = howmuch-perc
# )

# only distinguish between frame pieces in framed designs
percentages$frameframe <- 0
percentages <- percentages %>% mutate(
  frameframe = replace(frameframe, Frame & !isFrame, 1),
  frameframe = replace(frameframe, Frame & isFrame, 2)
)
percentages$frameframe <- c("Unframed", "Framed-inside", "Framed-frame")[percentages$frameframe+1]
percentages$frameframe <- factor(percentages$frameframe, levels=c("Unframed", "Framed-inside", "Framed-frame")) 
write.csv(percentages, "../data/pilotstudy-results.csv", row.names=FALSE)
```

```{r data-new, echo=FALSE, message=FALSE}
library(tidyverse)

percentages <- read.csv("../data/pilotstudy-results.csv")
percentages <- percentages %>% na.omit() %>% filter(howmuch < 75)
```

# Framed!

## Results from the pilot study

```{r}
length(unique(percentages$ResponseId))
```

- Lots of people responded to the pilot
- some in Nov - mostly Susan and me and unfortunate friends and family, 15 since yesterday - **THANK YOU!!!**

## 

```{r, echo=FALSE, fig.width=7.5, fig.height = 4.25}
percentages %>% na.omit() %>% ggplot(aes(x = perc, y = howmuch)) +
  geom_abline() +
  geom_point(aes(shape=isFrame, colour=isFrame)) +
  facet_grid(Frame~Type, labeller="label_both") +
  xlab("Actual Value") +
  ylab("Estimated Value") +
  theme_bw() +
  scale_colour_brewer("Frame piece estimate", palette="Set1") +
  scale_shape_discrete("Frame piece estimate") +
  theme(legend.position="bottom")
```

* frame pieces are not different from other pieces in designs without a frame
* pieces outside the frame have a tendency to be overestimated in framed designs
* pieces of the frame are underestimated in framed designs
* two weird outliers

## New variables

- measure error: difference between estimated and actual value 
    - positive: we visually overestimated
    - negative: we visually underestimated an area
- frame categories: only distinguish between frame and non-frame pieces in framed designs

## Some modelling

```{r, fig.height=4.5}
percentages %>% 
  ggplot(aes(x = perc, y = diff.error)) + geom_point() +
  facet_grid(.~Frame, labeller="label_both") +  geom_smooth(method="lm") +
  xlab("Actual Percentage") + ylab("Difference between Estimate and Actual Value")
```

##

```{r}
error0 <- lm(diff.error ~ perc*Frame, data = percentages)
summary(error0)
```

##

```{r, fig.height=4.5}
percentages %>% 
  ggplot(aes(x = perc, y = diff.error, colour=frameframe)) + geom_point() +
  facet_grid(.~Frame, labeller="label_both") + geom_smooth(method="lm") +
  xlab("Actual Percentage") + 
  ylab("Difference between Estimate and Actual Value") 
```

##

```{r}
error1 <- lm(diff.error ~ perc*frameframe, data = percentages)
# anova(error0, error1)
summary(error1)
```

##
```{r, fig.height=4.5}
percentages %>% 
  ggplot(aes(x = perc, y = diff.error, colour=frameframe)) + geom_point() +
  facet_grid(Type~Frame, labeller="label_both") + geom_smooth(method="lm") +
    xlab("Actual Percentage") + 
  ylab("Difference between Estimate and Actual Value")
```

##

```{r}
error2 <- lm(diff.error ~ perc*frameframe*Type, data = percentages)
anova(error1, error2)
```


## 

```{r}
summary(error2)
```